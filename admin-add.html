<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить администратора - DODGE VTK</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="admin-header">
        <div class="admin-logo">
            <i class="fas fa-truck"></i> DODGE VTK
        </div>
        <div class="admin-user">
            <span><i class="fas fa-user"></i> <span id="userName"></span></span>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Выйти
            </button>
        </div>
    </div>

    <div class="admin-container">
        <div class="welcome-card" style="display: block;">
            <h2 style="font-family: 'Oswald', sans-serif; margin-bottom: 1rem; color: #fff;">
                <i class="fas fa-user-plus" style="color: #ff6b00; margin-right: 10px;"></i> Добавить администратора
            </h2>
            <div style="color: #b0b0b0; margin-bottom: 2rem;">
                <i class="fas fa-info-circle" style="color: #ff6b00;"></i> Логин генерируется автоматически
            </div>

            <div class="login-preview">
                <i class="fas fa-key"></i>
                <div style="flex: 1;">
                    <div style="color: #b0b0b0; margin-bottom: 5px;">Сгенерированный логин:</div>
                    <div class="login-value" id="generatedLogin">GP_58295</div>
                </div>
                <button onclick="generateNewLogin()" style="background: none; border: none; color: #ff6b00; cursor: pointer; font-size: 1.2rem; padding: 0.5rem;">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>

            <div class="form-group">
                <label><i class="fas fa-tag"></i> Имя администратора</label>
                <input type="text" id="adminName" class="form-control" placeholder="Например: Иван Петров">
            </div>

            <div class="form-group">
                <label><i class="fas fa-lock"></i> Пароль</label>
                <input type="text" id="adminPassword" class="form-control" value="admin123">
                <small style="color: #b0b0b0; display: block; margin-top: 0.5rem;">
                    <i class="fas fa-info-circle" style="color: #ff6b00;"></i> Рекомендуется сменить пароль после первого входа
                </small>
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="addAdmin()" style="flex: 1;">
                    <i class="fas fa-save"></i> Создать администратора
                </button>
                <a href="admin-panel.html" class="btn-secondary" style="flex: 1; text-align: center;">
                    <i class="fas fa-times"></i> Отмена
                </a>
            </div>

            <div class="message success" id="successMessage">
                <i class="fas fa-check-circle"></i> Администратор успешно создан!
            </div>

            <div class="message error" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> Заполните все поля!
            </div>
        </div>
    </div>

    <script>
        // Проверка авторизации
        const currentUser = JSON.parse(sessionStorage.getItem('ets2CurrentUser'));
        
        if (!currentUser || currentUser.role !== 'owner') {
            window.location.href = 'admin.html';
        }

        document.getElementById('userName').textContent = currentUser.name;

        // Функция генерации логина
        function generateLogin() {
            const prefixes = ['GP', 'VTK', 'DODGE', 'TRUCK', 'DRIVER', 'ETS', 'EURO', 'DISP'];
            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const numbers = Math.floor(10000 + Math.random() * 90000);
            return `${prefix}_${numbers}`;
        }

        // Обновление отображаемого логина
        function generateNewLogin() {
            document.getElementById('generatedLogin').textContent = generateLogin();
        }

        // Добавление администратора
        function addAdmin() {
            const name = document.getElementById('adminName').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const username = document.getElementById('generatedLogin').textContent;

            if (!name || !password) {
                document.getElementById('errorMessage').style.display = 'flex';
                document.getElementById('successMessage').style.display = 'none';
                return;
            }

            // Загружаем текущих пользователей
            const users = JSON.parse(localStorage.getItem('ets2Users')) || [];

            // Проверяем уникальность логина
            if (users.some(u => u.username === username)) {
                alert('Такой логин уже существует! Сгенерируйте новый.');
                return;
            }

            // Добавляем нового администратора
            users.push({
                username: username,
                password: password,
                role: 'admin',
                name: name,
                addedBy: currentUser.username
            });

            // Сохраняем
            localStorage.setItem('ets2Users', JSON.stringify(users));

            // Показываем успех
            document.getElementById('successMessage').style.display = 'flex';
            document.getElementById('errorMessage').style.display = 'none';

            // Очищаем форму
            document.getElementById('adminName').value = '';
            document.getElementById('adminPassword').value = 'admin123';
            generateNewLogin();

            // Через 2 секунды перенаправляем
            setTimeout(() => {
                window.location.href = 'admin-panel.html';
            }, 2000);
        }

        function logout() {
            sessionStorage.removeItem('ets2CurrentUser');
            window.location.href = 'admin.html';
        }

        // Генерируем первый логин
        generateNewLogin();
    </script>
</body>
</html>